<section id="tela" class="container-fluid" ng-controller="genericController" ng-init="iniciar()">
  <div class="row">
    <div class="col-xs-7 col-sm-8 col-md-4 col-lg-4">
      <h4 class="titulo">&bull; {{model.titulo}}</h4>
    </div>
    <div class="col-xs-5 col-sm-4 hidden-md hidden-lg text-right" ng-hide="!model.novo.ativo">
      <button class="btn btn-success" type="button" ng-click="editar(model.novo.objeto)">
        <span class="glyphicon glyphicon-plus"></span>
        &nbsp;{{model.novo.texto}}
      </button>
    </div>
    <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6" ng-hide="!model.busca.ativo">
      <div class="input-group">
        <input type="text" class="form-control" placeholder="{{model.busca.texto}}" ng-model="view.pesquisa" ng-change=listar()>
        <span class="input-group-btn">
          <button class="btn btn-default" type="button" ng-click="listar()">
            <span class="glyphicon glyphicon-search"></span>
            &nbsp;Procurar
          </button>
        </span>
      </div>
    </div>
    <div class="hidden-xs hidden-sm col-md-2 col-lg-2 text-right" ng-hide="!model.novo.ativo">
      <button class="btn btn-success" type="button" ng-click="editar(model.novo.objeto)">
        <span class="glyphicon glyphicon-plus"></span>
        &nbsp;{{model.novo.texto}}
      </button>
    </div>
  </div>
  <div class="row">
    <div class="col-xs-12">
      <hr />
    </div>
  </div>
  <div class="row">
    <div class="col-md-12 table-responsive">
      <table class="table table-bordered table-striped table-hover">
        <tr>
          <th>Ações</th>
          <th ng-repeat="atual in model.campos | filter:{listar:true}">{{atual.nome}}</th>
        </tr>
        <tr ng-repeat="linha in view.registros">
          <td>
            <button class="btn btn-default" type="button" ng-click="excluir(linha[model.chave])">
              <span class="glyphicon glyphicon-remove"></span>
            </button>
            <button class="btn btn-default" type="button" ng-click="editar(linha)">
              <span class="glyphicon glyphicon-pencil"></span>
            </button>
          </td>
          <td ng-repeat="atual in model.campos | filter:{listar:true}">
            <span ng-switch="atual.tipo">
              <span ng-switch-when="email"><a ng-href="mailto:{{linha[atual.campo]}}">{{linha[atual.campo]}}</a></span>
              <span ng-switch-when="date">{{linha[atual.campo] | date:atual.formato}}</span>
              <span ng-switch-when="checkbox">{{linha[atual.campo] == atual.verdadeiro[0]? atual.verdadeiro[1] : atual.falso[1]}}</a></span>
              <span ng-switch-when="select">{{linha[atual.campo][atual.descricao]}}</span>
              <span ng-switch-default>{{linha[atual.campo]}}</span>
            </span>
          </td>
        </tr>
      </table>
    </div>
  </div>
  <div class="modal fade" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <form ng-submit="salvar()">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
            <h4 class="modal-title">{{model.titulo_modal}}</h4>
          </div>
          <div class="modal-body">
            <span ng-if="model.abas.ativo">
              <ul class="nav nav-tabs" role="tablist">
                <li ng-repeat="aba in model.abas.lista" role="presentation" ng-class="{'active' : $index==0}">
                  <a href="" data-target="#aba{{aba.id}}" role="tab" data-toggle="tab">{{aba.texto}}</a>
                </li>
              </ul>
              <div class="tab-content">
                <div ng-repeat="aba in model.abas.lista" id="aba{{aba.id}}" role="tabpanel" class="tab-pane" ng-class="{'active' : $index==0}">
                  <br>
                  <div ng-repeat="atual in model.campos | filter:{visivel:true, aba: aba.id}">
                    <span ng-include="'campos_modal'"></span>
                  </div>
                </div>
              </div>
            </span>
            <span ng-if="!model.abas.ativo">
              <div ng-repeat="atual in model.campos | filter:{visivel:true}">
                <span ng-include="'campos_modal'"></span>
              </div>
            </span>
          </div>
          <div class="modal-footer">
            <button type="submit" class="btn btn-success">Salvar</button>
            <button type="button" class="btn btn-default" data-dismiss="modal">Cancelar</button>
          </div>
        </form>
      </div>
    </div>
  </div>
  <script type="text/ng-template" id="campos_modal">
    <span ng-switch="atual.tipo">
      <div ng-switch-when="checkbox" class="checkbox">
        <label>
          <input type="checkbox" ng-model="view.selecionado[atual.campo]" ng-true-value="{{atual.verdadeiro[0]}}" ng-false-value="{{atual.falso[0]}}">&nbsp;{{atual.nome}}
        </label>
      </div>
      <div ng-switch-when="textarea" class="form-group">
        <label for="{{atual.campo}}">{{atual.nome}}</label>
        <textarea id="{{atual.campo}}" class="form-control" placeholder="{{atual.nome}}" ng-model="view.selecionado[atual.campo]" ng-required="atual.requerido" ng-readonly="!atual.editavel" rows="{{atual.linhas}}"></textarea>
      </div>
      <div ng-switch-when="select" class="form-group" ng-init="api(atual.url, 'GET', null, view, atual.lista)">
        <label for="{{atual.campo}}">{{atual.nome}}</label>
        <select id="{{atual.campo}}" class="form-control" ng-model="view.selecionado[atual.campo]" ng-required="atual.requerido" ng-disabled="!atual.editavel" ng-options="item as item[atual.descricao] for item in view[atual.lista] track by item.id">
          <option value="" disabled>Selecione</option>
        </select>
      </div>
      <div ng-switch-when="file">
        <label for="{{atual.campo}}">{{atual.nome}}</label>
        <div class="thumbnail text-center">
          <img ng-src="{{view.selecionado[atual.campo]}}" alt="Imagem não encontrada" />
          <div class="caption">
            <div class="input-group">
              <input type="text" class="form-control" placeholder="Selecionar arquivo..." disabled="" ng-value="view[atual.arquivo].name">
              <div class="input-group-btn">
                <button class="btn btn-default" type="button" ng-click="view[atual.campo]=undefined">
                  <span class="glyphicon glyphicon-remove"></span>
                </button>
                <label for="{{atual.campo}}" class="btn btn-default">
                  <span class="glyphicon glyphicon-folder-open"></span>
                </label>
              </div>
            </div>
            <input id="{{atual.campo}}" type="file" ng-model="view[atual.arquivo]" style="display:none" onchange="upload(event)">
          </div>
        </div>
      </div>
      <div ng-switch-when="date">
        <label for="{{atual.campo}}">{{atual.nome}}</label>
        <span ng-if="atual.editavel">
          <input id="{{atual.campo}}" type="text" class="form-control" placeholder="{{atual.nome}}" ng-model="view.selecionado[atual.campo]" ng-required="atual.requerido" ui-date-mask>
        </span>
        <span ng-if="!atual.editavel">
          <input id="{{atual.campo}}" type="text" class="form-control" placeholder="{{atual.nome}}" ng-value="view.selecionado[atual.campo] | date:atual.formato" readonly="">
        </span>
      </div>
      <div ng-switch-default class="form-group">
        <label for="{{atual.campo}}">{{atual.nome}}</label>
        <input id="{{atual.campo}}" type="{{atual.tipo}}" class="form-control" placeholder="{{atual.nome}}" ng-model="view.selecionado[atual.campo]" ng-required="atual.requerido" ng-readonly="!atual.editavel">
      </div>
    </span>
  </script>
</section>
